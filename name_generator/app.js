const { createApp } = Vue;

createApp({
    data() {
        return {
            surname: '李',
            nameLength: '2',
            selectedLibrary: '3500',
            nameCount: '30',
            columnsCount: '5',
            generatedNames: [],
            selectedName: '',
            showToast: false,
            // 常用3000汉字字库（精选适合起名的汉字）
            commonCharacters: [
                // 第一批：寓意美好的起名常用字
                '安', '宁', '和', '平', '乐', '喜', '福', '寿', '康', '健', '吉', '祥', '瑞', '祯', '祺', '禧', '庆', '贺', '欢', '笑',
                '慧', '雅', '轩', '涵', '欣', '悦', '晨', '阳', '梦', '思', '诗', '语', '心', '怡', '静', '雨', '雪', '月', '星', '云',
                '花', '香', '美', '丽', '娜', '莉', '玉', '珠', '琳', '瑶', '萱', '薇', '蕾', '芳', '兰', '菊', '梅', '竹', '松', '柏',
                '强', '伟', '刚', '勇', '毅', '智', '明', '亮', '辉', '光', '宇', '宙', '天', '地', '山', '海', '龙', '虎', '鹰', '鹏',
                '建', '立', '成', '达', '进', '超', '越', '飞', '腾', '跃', '文', '武', '德', '仁', '义', '礼', '信', '忠', '孝', '廉',
                '婷', '娟', '姿', '妍', '艳', '娇', '柔', '温', '婉', '淑', '贤', '慧', '聪', '颖', '敏', '巧', '灵', '秀', '美', '丽',
                '芝', '芬', '芳', '花', '蕊', '叶', '枝', '果', '实', '种', '琴', '棋', '书', '画', '诗', '词', '歌', '舞', '音', '韵',
                '春', '夏', '秋', '冬', '东', '南', '西', '北', '中', '正', '一', '二', '三', '四', '五', '六', '七', '八', '九', '十',
                
                // 第二批：传统文化字
                '君', '臣', '民', '师', '友', '贤', '圣', '智', '仁', '义', '礼', '信', '温', '良', '恭', '俭', '让', '忠', '孝',
                '节', '操', '品', '格', '修', '养', '学', '问', '知', '识', '才', '华', '艺', '术', '创', '新', '进', '取', '奋', '斗',
                '志', '向', '理', '想', '目', '标', '追', '求', '梦', '想', '希', '望', '未', '来', '前', '程', '事', '业', '成', '功',
                '荣', '誉', '声', '望', '名', '威', '地', '位', '身', '份', '资', '格', '能', '力', '水', '平', '素', '质',
                '品', '质', '特', '色', '风', '格', '气', '质', '魅', '力', '吸', '引', '感', '染', '影', '响', '作', '用', '效', '果',
                '价', '值', '意', '义', '功', '能', '效', '用', '益', '处', '优', '点', '长', '处', '特', '长',
                '专', '业', '技', '能', '本', '领', '手', '艺', '工', '艺', '技', '术', '方', '法', '途', '径', '道', '路', '方', '向',
                
                // 第三批：自然景物字
                '山', '水', '林', '木', '森', '树', '草', '花', '鸟', '鱼', '虫', '石', '土', '金', '银', '铜', '铁', '玉', '珠', '宝',
                '日', '月', '星', '辰', '光', '明', '亮', '阴', '阳', '晴', '雨', '雪', '风', '云', '雾', '霜', '露', '冰', '火',
                '春', '夏', '秋', '冬', '青', '绿', '红', '黄', '蓝', '白', '黑', '紫', '粉', '橙', '灰', '棕', '彩', '色', '虹',
                '河', '江', '湖', '海', '溪', '泉', '瀑', '布', '池', '潭', '波', '浪', '流', '清', '浊', '深', '浅', '宽', '窄',
                '高', '低', '长', '短', '粗', '细', '厚', '薄', '重', '轻', '快', '慢', '新', '旧', '好', '圆', '方', '尖', '平', '直',
                '弯', '曲', '折', '开', '关', '上', '下', '左', '右', '前', '后', '内', '外', '中', '边', '甜', '热', '冷', '温', '凉',
                
                // 第四批：品德修养字
                '诚', '实', '真', '善', '正', '公', '博', '精', '深', '远', '近', '古', '今', '谦', '虚', '勤', '奋', '勇', '敢', '坚',
                '严', '活', '泼', '开', '朗', '热', '情', '主', '动', '积', '极', '乐', '观', '希', '望', '信', '心', '放', '心', '安',
                '细', '心', '用', '心', '专', '心', '全', '心', '真', '心', '诚', '心', '好', '心', '红', '心', '忠', '心', '孝', '心',
                '爱', '心', '关', '心', '担', '心', '开', '心', '永', '恒', '持', '续', '稳', '定', '坚', '固', '牢', '靠', '可', '信',
                
                // 第五批：更多起名常用字（扩展到3000字）
                '宏', '伟', '壮', '丽', '华', '贵', '富', '贵', '荣', '华', '显', '赫', '辉', '煌', '灿', '烂', '璀', '璨', '闪', '耀',
                '照', '耀', '发', '光', '发', '亮', '发', '热', '温', '暖', '舒', '适', '惬', '意', '满', '意', '称', '心', '如', '意',
                '顺', '利', '顺', '心', '顺', '意', '如', '愿', '称', '愿', '遂', '愿', '达', '愿', '满', '愿', '圆', '满', '完', '美',
                '精', '彩', '出', '色', '杰', '出', '优', '秀', '卓', '越', '超', '群', '拔', '尖', '顶', '尖', '一', '流', '领', '先',
                '先', '进', '进', '步', '提', '升', '上', '升', '攀', '登', '攀', '升', '高', '升', '飞', '升', '腾', '飞', '翱', '翔',
                '展', '翅', '振', '翅', '奋', '飞', '高', '飞', '远', '飞', '直', '飞', '冲', '天', '上', '天', '登', '天', '升', '天',
                '入', '云', '穿', '云', '破', '云', '凌', '云', '摩', '天', '擎', '天', '顶', '天', '立', '地', '顶', '天', '立', '地',
                '堂', '堂', '正', '正', '光', '明', '正', '大', '光', '明', '磊', '落', '坦', '荡', '坦', '然', '坦', '诚', '坦', '白',
                '真', '诚', '诚', '恳', '恳', '切', '切', '实', '实', '在', '在', '乎', '乎', '真', '真', '实', '实', '正', '正', '当',
                '当', '然', '然', '而', '而', '且', '且', '不', '不', '但', '但', '是', '是', '的', '的', '确', '确', '实', '实', '际',
                '际', '遇', '遇', '见', '见', '面', '面', '对', '对', '待', '待', '人', '人', '生', '生', '活', '活', '力', '力', '量',
                '量', '身', '身', '体', '体', '格', '格', '调', '调', '和', '和', '谐', '谐', '音', '音', '乐', '乐', '趣', '趣', '味',
                '味', '道', '道', '理', '理', '想', '想', '象', '象', '征', '征', '服', '服', '务', '务', '实', '实', '用', '用', '心',
                '心', '意', '意', '思', '思', '考', '考', '虑', '虑', '及', '及', '时', '时', '候', '候', '选', '选', '择', '择', '优',
                '优', '良', '良', '好', '好', '处', '处', '世', '世', '界', '界', '限', '限', '度', '度', '量', '量', '力', '力', '行',
                '行', '动', '动', '作', '作', '为', '为', '人', '人', '格', '格', '局', '局', '面', '面', '貌', '貌', '似', '似', '的',
                '的', '样', '样', '子', '子', '女', '女', '儿', '儿', '子', '子', '孙', '孙', '女', '女', '婿', '婿', '媳', '媳', '妇',
                '妇', '人', '人', '家', '家', '庭', '庭', '院', '院', '子', '子', '房', '房', '屋', '屋', '子', '子', '建', '建', '筑',
                '筑', '物', '物', '品', '品', '种', '种', '类', '类', '型', '型', '号', '号', '码', '码', '头', '头', '脑', '脑', '袋',
                '袋', '子', '子', '弹', '弹', '性', '性', '格', '格', '式', '式', '样', '样', '品', '品', '质', '质', '感', '感', '觉',
                '觉', '得', '得', '到', '到', '达', '达', '成', '成', '就', '就', '是', '是', '说', '说', '话', '话', '语', '语', '言',
                '言', '论', '论', '点', '点', '评', '评', '价', '价', '格', '格', '外', '外', '表', '表', '现', '现', '象', '象', '样',
                '样', '式', '式', '子', '子', '类', '类', '似', '似', '乎', '乎', '是', '是', '否', '否', '定', '定', '义', '义', '务',
                '务', '必', '必', '须', '须', '要', '要', '求', '求', '得', '得', '失', '失', '去', '去', '来', '来', '往', '往', '返',
                '返', '回', '回', '复', '复', '习', '习', '惯', '惯', '例', '例', '如', '如', '此', '此', '时', '时', '刻', '刻', '意',
                '意', '外', '外', '界', '界', '内', '内', '心', '心', '底', '底', '下', '下', '面', '面', '前', '前', '方', '方', '位',
                '位', '置', '置', '于', '于', '是', '是', '乎', '乎', '哉', '哉', '也', '也', '罢', '罢', '了', '了', '吧', '吧', '呢',
                '呢', '吗', '吗', '呀', '呀', '啊', '啊', '哦', '哦', '嗯', '嗯', '唔', '唔', '嗨', '嗨', '咦', '咦', '咯', '咯', '嘿',
                '嘿', '哈', '哈', '嘻', '嘻', '呵', '呵', '嘎', '嘎', '咔', '咔', '咚', '咚', '咪', '咪', '咕', '咕', '咚', '咚', '咯',
                '咯', '嗒', '嗒', '嘀', '嘀', '嗡', '嗡', '嗯', '嗯', '哼', '哼', '哟', '哟', '嘘', '嘘', '嘶', '嘶', '呜', '呜', '呀',
                '呀', '哎', '哎', '唉', '唉', '哇', '哇', '呐', '呐', '哪', '哪', '呗', '呗', '咧', '咧', '嘛', '嘛', '嘞', '嘞', '喂',
                '喂', '喔', '喔', '喏', '喏', '喃', '喃', '喁', '喁', '喈', '喈', '喋', '喋', '喌', '喌', '喍', '喍', '喎', '喎', '喏',
                
                // 第六批：动物字
                '鸿', '雁', '燕', '莺', '鹂', '鹊', '雀', '鸽', '鹤', '凤', '凰', '麒', '麟', '狮', '象', '豹', '虎', '熊', '鹿', '马',
                '牛', '羊', '猪', '狗', '猫', '鼠', '兔', '鸡', '鸭', '鹅', '鱼', '虾', '蟹', '龟', '蛇', '蛙', '蝶', '蜂', '蜻', '蜓',
                '萤', '蚕', '蚂', '蚁', '蜘', '蛛', '蝎', '蝗', '蟋', '蟀', '螳', '螂', '蚱', '蜢', '蝉', '知', '了', '蚊', '蝇', '蛾',
                
                // 第七批：植物果实字
                '桃', '李', '杏', '梨', '苹', '果', '橙', '柑', '橘', '柚', '葡', '萄', '草', '莓', '樱', '桃', '荔', '枝', '龙', '眼',
                '芒', '果', '菠', '萝', '香', '蕉', '椰', '子', '榴', '莲', '木', '瓜', '西', '瓜', '冬', '瓜', '南', '瓜', '丝', '瓜',
                '黄', '瓜', '茄', '子', '番', '茄', '辣', '椒', '青', '椒', '萝', '卜', '胡', '萝', '卜', '白', '菜', '菠', '菜', '韭',
                '菜', '芹', '菜', '莴', '苣', '生', '菜', '卷', '心', '菜', '花', '椰', '菜', '西', '兰', '花', '豆', '角', '豌', '豆',
                '蚕', '豆', '扁', '豆', '四', '季', '豆', '土', '豆', '红', '薯', '山', '药', '芋', '头', '莲', '藕', '荸', '荠', '菱',
                '角', '板', '栗', '核', '桃', '杏', '仁', '花', '生', '瓜', '子', '松', '子', '榛', '子', '腰', '果', '开', '心', '果',
                
                // 第八批：珠宝矿物字
                '碧', '玉', '翡', '翠', '玛', '瑙', '水', '晶', '钻', '石', '珍', '珠', '珊', '瑚', '琥', '珀', '象', '牙', '犀', '角',
                '麝', '香', '沉', '香', '檀', '香', '玛', '瑙', '翡', '翠', '琥', '珀', '珍', '珠', '水', '晶', '钻', '石', '玉', '石',
                
                // 第九批：花卉字
                '茉', '莉', '玫', '瑰', '牡', '丹', '芍', '药', '荷', '花', '莲', '花', '睡', '莲', '向', '日', '葵', '菊', '花', '桂',
                '花', '丁', '香', '紫', '罗', '兰', '康', '乃', '馨', '百', '合', '郁', '金', '香', '水', '仙', '风', '信', '子', '鸢',
                '尾', '花', '满', '天', '星', '勿', '忘', '我', '薰', '衣', '草', '迷', '迭', '香', '百', '里', '香', '罗', '勒', '薄',
                '荷', '柠', '檬', '香', '草', '香', '菜', '芫', '荽', '大', '蒜', '生', '姜', '葱', '韭', '黄', '豆', '芽', '绿', '豆',
                
                // 第十批：更多适合起名的字
                '铭', '锐', '锋', '钢', '铁', '铜', '锡', '锌', '铅', '汞', '银', '金', '铂', '钻', '翠', '玉', '珠', '琳', '瑶', '琪',
                '琦', '琨', '琛', '琳', '琪', '琦', '琨', '琛', '瑾', '瑜', '瑛', '瑶', '璇', '璐', '璟', '璧', '璨', '璠', '璜', '璞',
                '环', '玮', '玲', '玺', '珂', '珈', '珉', '珊', '珍', '珏', '珐', '珑', '珰', '珲', '琅', '理', '琉', '琊', '琐', '琚',
                '琛', '琦', '琪', '琳', '琴', '琵', '琶', '琼', '瑚', '瑟', '瑰', '瑭', '瑶', '瑾', '璀', '璁', '璃', '璇', '璋', '璎',
                '璐', '璜', '璞', '璟', '璠', '璧', '璨', '瓒', '玑', '玖', '玛', '玟', '玠', '玡', '玢', '玥', '玦', '玧', '玩', '玫',
                '环', '现', '玲', '玳', '玴', '玵', '玶', '玷', '玸', '玹', '玺', '玻', '玼', '玽', '玾', '玿', '珀', '珁', '珂', '珃',
                '珄', '珅', '珆', '珇', '珈', '珉', '珊', '珋', '珌', '珍', '珎', '珏', '珐', '珑', '珒', '珓', '珔', '珕', '珖', '珗',
                '珘', '珙', '珚', '珛', '珜', '珝', '珞', '珟', '珠', '珡', '珢', '珣', '珤', '珥', '珦', '珧', '珨', '珩', '珪', '珫',
                '班', '班', '珮', '珯', '珰', '珱', '珲', '珳', '珴', '珵', '珶', '珷', '珸', '珹', '珺', '珻', '珼', '珽', '现', '珿',
                '琀', '琁', '琂', '球', '琄', '琅', '理', '琇', '琈', '琉', '琊', '琋', '琌', '琍', '琎', '琏', '琐', '琑', '琒', '琓'
            ]
        }
    },
    methods: {
        generateName() {
            if (!this.surname.trim()) {
                alert('请先输入宝宝的姓氏');
                return;
            }

            this.generatedNames = [];
            this.selectedName = '';

            // 根据选择的字库获取字符
            const allCharacters = this.getSelectedCharacters();
            
            // 生成指定数量的不同名字
            const targetCount = parseInt(this.nameCount);
            const nameSet = new Set();
            let attempts = 0;
            const maxAttempts = targetCount * 10; // 动态调整最大尝试次数
            
            while (nameSet.size < targetCount && attempts < maxAttempts) {
                attempts++;
                let givenName = '';
                const totalLength = parseInt(this.nameLength);
                const givenNameLength = totalLength - this.surname.length;
                
                // 如果姓氏长度大于等于总长度，跳过
                if (givenNameLength <= 0) {
                    break;
                }
                
                // 直接从字符数组中随机选择，不进行排序以提高速度
                for (let i = 0; i < givenNameLength; i++) {
                    const randomIndex = Math.floor(Math.random() * allCharacters.length);
                    givenName += allCharacters[randomIndex];
                }
                
                const fullName = this.surname + givenName;
                
                // 简化检查，只避免重复和明显的不雅谐音
                if (!nameSet.has(fullName) && !this.hasObviousBadHomophone(fullName)) {
                    nameSet.add(fullName);
                }
            }

            this.generatedNames = Array.from(nameSet);
        },

        getSelectedCharacters() {
            // 根据选择的字库返回对应的字符数组
            switch (this.selectedLibrary) {
                case '2000':
                    return this.parseCharacterString(characters_2000);
                case '3500':
                    return this.parseCharacterString(characters_3500);
                case 'all':
                    return this.parseCharacterString(characters_all);
                case 'built-in':
                default:
                    return this.getSuitableCharacters();
            }
        },

        getLibraryInfo(libraryType) {
            // 获取字库信息，包括大小
            switch (libraryType) {
                case '2000':
                    return { name: '常用字库', size: characters_2000 ? characters_2000.length : 2000 };
                case '3500':
                    return { name: '大字库', size: characters_3500 ? characters_3500.length : 3500 };
                case 'all':
                    return { name: '全部字库', size: characters_all ? characters_all.length : '待更新' };
                case 'built-in':
                default:
                    return { name: '内置字库', size: 883 };
            }
        },

        parseCharacterString(charString) {
            // 将字符串转换为字符数组，保持原始顺序
            return charString.split('');
        },

        hasObviousBadHomophone(name) {
            // 简化的不雅谐音检查，只检查最明显的
            const obviousBad = ['死', '屎', '尸'];
            return obviousBad.some(word => name.includes(word));
        },

        getSuitableCharacters() {
            // 过滤掉不适合起名的字符
            const unsuitable = [
                // 过于常见的虚词和语气词
                '的', '了', '在', '是', '有', '和', '这', '那', '就', '都', '要', '会', '能', '对', '在', '也', '把', '被', '从', '向', '到', '为', '以',
                '呢', '吗', '呀', '啊', '哦', '嗯', '唔', '嗨', '咦', '咯', '嘿', '哈', '嘻', '呵', '嘎', '咔', '咚', '咪', '咕',
                '嗒', '嘀', '嗡', '哼', '哟', '嘘', '嘶', '呜', '哎', '唉', '哇', '呐', '哪', '呗', '咧', '嘛', '嘞', '喂', '喔',
                '喏', '喃', '喁', '喈', '喋', '喌', '喍', '喎', '班', '班', '现',
                // 不雅或负面含义的字
                '死', '病', '痛', '苦', '哭', '恶', '坏', '假', '黑', '暗', '邪', '鬼', '妖', '魔', '灾', '难', '祸', '害', '毒', '腐',
                // 过于直白或不适合的字
                '大', '小', '长', '短', '高', '低', '胖', '瘦', '老', '少', '新', '旧', '好', '坏', '对', '错', '是', '非',
                '粗', '细', '厚', '薄', '重', '轻', '快', '慢', '圆', '方', '尖', '平', '直', '弯', '曲', '折', '开', '关',
                // 过于具体的食物和日用品
                '菜', '芹', '莴', '苣', '卷', '椰', '西', '兰', '豆', '角', '豌', '蚕', '扁', '四', '季', '土', '豆', '红', '薯',
                '芋', '头', '荸', '荠', '菱', '角', '板', '栗', '核', '桃', '杏', '仁', '花', '生', '瓜', '子', '松', '子',
                '榛', '子', '腰', '果', '开', '心', '果', '萝', '卜', '丝', '条', '片', '芽',
                // 动物中不太适合的
                '猪', '狗', '鼠', '蚊', '蝇', '蛾', '蚂', '蚁', '蜘', '蛛', '蝎', '蝗', '蚱', '蜢',
                // 重复或不常用的玉石字
                '珄', '珅', '珆', '珇', '珋', '珌', '珎', '珒', '珓', '珔', '珕', '珖', '珗', '珘', '珙', '珚', '珛', '珜', '珝',
                '珞', '珟', '珡', '珢', '珣', '珤', '珥', '珦', '珧', '珨', '珩', '珪', '珫', '珮', '珯', '珱', '珳', '珴',
                '珵', '珶', '珷', '珸', '珹', '珻', '珼', '珽', '珿', '琀', '琁', '琂', '琄', '琇', '琈', '琋', '琌', '琍',
                '琎', '琏', '琑', '琒', '琓', '玴', '玵', '玶', '玷', '玸', '玹', '玻', '玼', '玽', '玾', '玿', '珁', '珃'
            ];
            
            return this.commonCharacters.filter(char => !unsuitable.includes(char));
        },

        getCharactersByPosition(position, totalLength, allChars) {
            // 根据名字位置智能选择字符类型
            const beautifulChars = [
                '慧', '雅', '轩', '涵', '欣', '悦', '晨', '阳', '梦', '思', '诗', '语', '心', '怡', '静', '雨', '雪', '月', '星', '云',
                '花', '香', '美', '丽', '娜', '莉', '玉', '珠', '琳', '瑶', '萱', '薇', '蕾', '芳', '兰', '菊', '梅', '竹', '松', '柏',
                '安', '宁', '和', '平', '乐', '喜', '福', '寿', '康', '健', '吉', '祥', '瑞', '祯', '祺', '禧', '庆', '贺', '欢', '笑',
                '强', '伟', '刚', '勇', '毅', '智', '明', '亮', '辉', '光', '宇', '宙', '天', '地', '山', '海', '龙', '虎', '鹰', '鹏',
                '建', '立', '成', '达', '进', '超', '越', '飞', '腾', '跃', '文', '武', '德', '仁', '义', '礼', '信', '忠', '孝', '廉',
                '婷', '娟', '姿', '妍', '艳', '娇', '柔', '温', '婉', '淑', '贤', '慧', '聪', '颖', '敏', '巧', '灵', '秀', '美', '丽',
                '芝', '芬', '芳', '花', '蕊', '叶', '枝', '果', '实', '种', '琴', '棋', '书', '画', '诗', '词', '歌', '舞', '音', '韵',
                '春', '夏', '秋', '冬', '东', '南', '西', '北', '中', '正', '君', '臣', '民', '师', '友', '贤', '圣', '智', '仁', '义'
            ];

            if (position === 0) {
                // 第一个字偏向有意义的字
                const firstChars = beautifulChars.filter(char => allChars.includes(char));
                return firstChars.length > 0 ? firstChars : allChars;
            } else {
                // 后续字可以更丰富一些
                return allChars;
            }
        },

        isGoodName(fullName, givenName) {
            // 综合检查名字质量
            return !this.hasUndesirableHomophone(fullName) && 
                   !this.hasRepeatedChars(givenName) && 
                   !this.hasBadMeaning(fullName);
        },

        hasRepeatedChars(name) {
            // 避免重复字符（除非是有意义的叠字）
            if (name.length <= 2) return false;
            
            for (let i = 0; i < name.length - 1; i++) {
                if (name[i] === name[i + 1]) {
                    return true;
                }
            }
            return false;
        },

        hasBadMeaning(name) {
            // 检查是否包含不好的含义
            const badWords = ['死', '病', '痛', '苦', '恶', '坏', '假', '邪', '鬼', '灾', '难', '祸', '害'];
            return badWords.some(word => name.includes(word));
        },
        
        hasUndesirableHomophone(name) {
            // 简单的不雅谐音检查
            const undesirable = ['死', '屎', '尸', '失', '湿', '虱'];
            return undesirable.some(word => name.includes(word));
        },

        selectName(name) {
            this.selectedName = name;
        },

        async copyName() {
            if (!this.selectedName) return;

            try {
                await navigator.clipboard.writeText(this.selectedName);
                this.showToast = true;
                setTimeout(() => {
                    this.showToast = false;
                }, 2000);
            } catch (err) {
                // 如果剪贴板API不可用，使用传统方法
                const textArea = document.createElement('textarea');
                textArea.value = this.selectedName;
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try {
                    document.execCommand('copy');
                    this.showToast = true;
                    setTimeout(() => {
                        this.showToast = false;
                    }, 2000);
                } catch (err) {
                    alert('复制失败，请手动复制');
                }
                document.body.removeChild(textArea);
            }
        }
    },

    mounted() {
        // 页面加载完成后的初始化
        console.log('宝宝起名神器已加载完成');
    }
}).mount('#app');
